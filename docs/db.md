# DB

Ниже краткое описание схемы БД, которая поднимается миграциями.
Графическую схему можно найти [тут](https://dbdocs.io/dev-7361cc0585/Backend-trainee-assignment-autumn-2025/v/1?view=relationships)

## Типы

### Тип `pull_request_status`

Enum для статуса PR:

| Значение | Пояснение          |
| -------- | -------------------|
| `OPEN`   | PR открыт          |
| `MERGED` | PR смержен (закрыт)|

## Таблицы

### Таблица `teams`

Список команд.

| Поле       | Тип  | Пояснение                   |
| ---------- | ---- | --------------------------- |
| team_name  | text | Уникальное имя команды (PK) |

#### Ключи и связи

- Первичный ключ: `team_name`.

### Таблица `users`

Пользователи и их принадлежность к командам.

| Поле      | Тип    | Пояснение                                         |
| --------- | ------ | ------------------------------------------------- |
| user_id   | text   | Уникальный идентификатор пользователя (PK)        |
| username  | text   | Имя пользователя                                  |
| team_name | text   | Имя команды, ссылка на `teams.team_name`          |
| is_active | bool   | Флаг активности пользователя, по умолчанию `true` |

#### Ключи и связи

- Первичный ключ: `user_id`.
- Внешний ключ: `team_name` -> `teams.team_name`.
- Индекс: `idx_users_team_name` по полю `team_name` (для выборок по команде).

### Таблица `pull_requests`

Основная сущность PR.

| Поле              | Тип                 | Пояснение                                          |
| ----------------- | ------------------- | -------------------------------------------------- |
| pull_request_id   | text                | Уникальный идентификатор PR (PK)                   |
| pull_request_name | text                | Короткое название PR                               |
| author_id         | text                | Автор PR, ссылка на `users.user_id`                |
| status            | pull_request_status | Статус PR (`OPEN` / `MERGED`), по умолчанию `OPEN` |
| created_at        | timestamptz         | Время создания PR, по умолчанию `now()`            |
| merged_at         | timestamptz         | Время merge PR, может быть `NULL`                  |

#### Ключи и связи

- Первичный ключ: `pull_request_id`.
- Внешний ключ: `author_id` -> `users.user_id`.


### Таблица `assigned_reviewers`

Связь PR ↔ назначенные ревьюверы (многие ко многим).

| Поле            | Тип  | Пояснение                                     |
| --------------- | ---- | --------------------------------------------- |
| pull_request_id | text | Идентификатор PR, ссылка на `pull_requests`   |
| user_id         | text | Идентификатор ревьювера, ссылка на `users`    |

#### Ключи и связи

- Составной первичный ключ: (`pull_request_id`, `user_id`) — один и тот же пользователь не может быть назначен на PR дважды.
- Внешний ключ: `pull_request_id` -> `pull_requests.pull_request_id`.
- Внешний ключ: `user_id` -> `users.user_id`.
- Индекс: `idx_assigned_reviewers_user_id` по полю `user_id` (быстрые выборки PR по ревьюверу).
